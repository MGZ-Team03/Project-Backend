# í•™ìƒ ìƒíƒœ ì—…ë°ì´íŠ¸ êµ¬í˜„ ë¡œë“œë§µ

## ğŸ“‹ ëª©ì°¨
1. [ê°œìš”](#ê°œìš”)
2. [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
3. [ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°](#ë°ì´í„°ë² ì´ìŠ¤-êµ¬ì¡°)
4. [ë°±ì—”ë“œ êµ¬í˜„](#ë°±ì—”ë“œ-êµ¬í˜„)
5. [í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„](#í”„ë¡ íŠ¸ì—”ë“œ-êµ¬í˜„)
6. [ìƒíƒœ íŒë‹¨ ë¡œì§](#ìƒíƒœ-íŒë‹¨-ë¡œì§)
7. [ì‚¬ìš© ê°€ì´ë“œ](#ì‚¬ìš©-ê°€ì´ë“œ)
8. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)

---

## ê°œìš”

### ëª©ì 
íŠœí„°ê°€ ë‹´ë‹¹ í•™ìƒì˜ ì‹¤ì‹œê°„ í™œë™ ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ìˆëŠ” ì‹œìŠ¤í…œ êµ¬í˜„

### í•™ìƒ ìƒíƒœ ì¢…ë¥˜
| ìƒíƒœ | í‘œì‹œ | ì¡°ê±´ |
|------|------|------|
| **AIëŒ€í™”ì¤‘** | ğŸŸ¢ | 5ë¶„ ì´ë‚´ í™œë™ + room="ai" |
| **ë¬¸ì¥ì—°ìŠµì¤‘** | ğŸŸ¢ | 5ë¶„ ì´ë‚´ í™œë™ + room="sentence" |
| **ì˜¨ë¼ì¸** | ğŸŸ¡ | 5ë¶„ ì´ë‚´ í™œë™ + room="no room" |
| **ìë¦¬ë¹„ì›€** | ğŸŸ¡ | 5~30ë¶„ ì „ í™œë™ |
| **ì˜¤í”„ë¼ì¸** | âšª | 30ë¶„ ì´ìƒ ë¹„í™œì„± ë˜ëŠ” ë¡œê·¸ì•„ì›ƒ |

### í•µì‹¬ ê¸°ëŠ¥
- âœ… í˜ì´ì§€ ì ‘ì†/ì´ë™ ì‹œ ìë™ ìƒíƒœ ì—…ë°ì´íŠ¸
- âœ… ë¸Œë¼ìš°ì € ì¢…ë£Œ ì‹œ ì˜¤í”„ë¼ì¸ ì²˜ë¦¬
- âœ… updated_at íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜ ì‹¤ì‹œê°„ì„± íŒë‹¨
- âœ… ë¡œê·¸ì¸ ìœ ì§€ (localStorage + RefreshToken)

---

## ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        í•™ìƒ (Student)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  HomePage / ChatPage / PracticePage                    â”‚  â”‚
â”‚  â”‚  â†’ useStudentStatus(user, location)                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â”‚                                  â”‚
â”‚                            â†“                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  POST /api/student-status                              â”‚  â”‚
â”‚  â”‚  { studentEmail, status, room }                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Lambda (StudentStatusFunction)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Controller â†’ Service â†’ Repository                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â”‚                                  â”‚
â”‚                            â†“                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  DynamoDB (tutor_students)                             â”‚  â”‚
â”‚  â”‚  - tutor_email (PK)                                    â”‚  â”‚
â”‚  â”‚  - student_email (SK)                                  â”‚  â”‚
â”‚  â”‚  - status: "active" | "inactive"                       â”‚  â”‚
â”‚  â”‚  - room: "ai" | "sentence" | "no room"                 â”‚  â”‚
â”‚  â”‚  - updated_at: 1738012345678 (ë°€ë¦¬ì´ˆ)                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        íŠœí„° (Tutor)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  TutorDashboard                                        â”‚  â”‚
â”‚  â”‚  â†’ useTutorStudents()                                  â”‚  â”‚
â”‚  â”‚  â†’ GET /api/tutor/students                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â”‚                                  â”‚
â”‚                            â†“                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  StudentStatusCard (í•™ìƒë³„)                            â”‚  â”‚
â”‚  â”‚  - getStudentStatus() â†’ ğŸŸ¢/ğŸŸ¡/âšª                       â”‚  â”‚
â”‚  â”‚  - getTimeAgo() â†’ "3ë¶„ ì „"                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°

### DynamoDB: `tutor_students` í…Œì´ë¸”

#### í‚¤ ìŠ¤í‚¤ë§ˆ
```yaml
PartitionKey: tutor_email (String)
SortKey: student_email (String)
```

#### GSI (Global Secondary Index)
```yaml
IndexName: student_email-index
PartitionKey: student_email (String)
```

#### ì†ì„± (Attributes)
```javascript
{
  tutor_email: "tutor@example.com",        // PK - íŠœí„° ì´ë©”ì¼
  student_email: "student@example.com",    // SK - í•™ìƒ ì´ë©”ì¼
  status: "active",                        // "active" | "inactive"
  room: "ai",                              // "ai" | "sentence" | "no room"
  updated_at: 1738012345678,               // Number - ë°€ë¦¬ì´ˆ íƒ€ì„ìŠ¤íƒ¬í”„
  assigned_at: "2026-01-27T10:00:00Z"      // String - í• ë‹¹ ì‹œê°„
}
```

#### ì¿¼ë¦¬ íŒ¨í„´
1. **íŠœí„°ì˜ ëª¨ë“  í•™ìƒ ì¡°íšŒ**
   ```java
   Query(tutor_email = "tutor@example.com")
   ```

2. **í•™ìƒì˜ íŠœí„° ì°¾ê¸°**
   ```java
   Query(student_email-index, student_email = "student@example.com")
   ```

---

## ë°±ì—”ë“œ êµ¬í˜„

### 1. StudentStatusFunction (ìƒíƒœ ì €ì¥)

#### ğŸ“ íŒŒì¼ êµ¬ì¡°
```
StudentStatusFunction/
â”œâ”€â”€ StudentStatusHandler.java
â”œâ”€â”€ controller/
â”‚   â””â”€â”€ StudentStatusController.java
â”œâ”€â”€ service/
â”‚   â””â”€â”€ StudentStatusService.java
â”œâ”€â”€ repository/
â”‚   â””â”€â”€ StudentStatusRepository.java
â””â”€â”€ dto/
    â”œâ”€â”€ StudentStatusRequest.java
    â”œâ”€â”€ StudentStatusEventRequest.java
    â””â”€â”€ StudentStatusResponse.java
```

#### API ì—”ë“œí¬ì¸íŠ¸
```
POST /api/student-status
```

#### ìš”ì²­ ì˜ˆì‹œ
```json
{
  "action": "/chat",
  "data": {
    "studentEmail": "student@example.com",
    "status": "active",
    "room": "ai"
  }
}
```

#### ì‘ë‹µ ì˜ˆì‹œ
```json
{
  "studentEmail": "student@example.com",
  "status": "active",
  "room": "ai"
}
```

#### í•µì‹¬ ë¡œì§ (Repository)
```java
// StudentStatusRepository.java
public void saveStudentStatus(StudentStatusRequest request) {
    // 1. í•™ìƒì˜ ê¸°ì¡´ íŠœí„° ì¡°íšŒ (GSI ì‚¬ìš©)
    Map<String, AttributeValue> emails = findByStudentEmail(request.getStudentEmail());
    
    String tutorEmail = (emails != null && emails.get("tutor_email") != null)
        ? emails.get("tutor_email").s()
        : "undefined";
    
    // 2. DynamoDBì— ì €ì¥/ì—…ë°ì´íŠ¸
    Map<String, AttributeValue> item = new HashMap<>();
    item.put("tutor_email", AttributeValue.builder().s(tutorEmail).build());
    item.put("student_email", AttributeValue.builder().s(request.getStudentEmail()).build());
    item.put("status", AttributeValue.builder().s(request.getStatus()).build());
    item.put("room", AttributeValue.builder().s(request.getRoom()).build());
    item.put("updated_at", AttributeValue.builder()
        .n(String.valueOf(Instant.now().toEpochMilli())).build());
    
    dynamoDbClient.putItem(PutItemRequest.builder()
        .tableName(tutorStudentsTable)
        .item(item)
        .build());
}
```

---

### 2. TutorFunction (í•™ìƒ ëª©ë¡ ì¡°íšŒ)

#### API ì—”ë“œí¬ì¸íŠ¸
```
GET /api/tutor/students
```

#### ì‘ë‹µ ì˜ˆì‹œ
```json
{
  "success": true,
  "data": {
    "students": [
      {
        "studentEmail": "student1@example.com",
        "studentName": "í™ê¸¸ë™",
        "status": "active",
        "room": "ai",
        "updated_at": 1738012345678,
        "assignedAt": "2026-01-27T10:00:00Z"
      },
      {
        "studentEmail": "student2@example.com",
        "studentName": "ê¹€ì² ìˆ˜",
        "status": "inactive",
        "room": "no room",
        "updated_at": 1738010000000,
        "assignedAt": "2026-01-26T15:30:00Z"
      }
    ]
  }
}
```

#### í•µì‹¬ ë¡œì§ (Handler)
```java
// TutorFeedbackHandler.java - handleGetStudents()
private APIGatewayProxyResponseEvent handleGetStudents(...) {
    String tutorEmail = extractUserEmail(input, context);
    
    QueryResponse queryResponse = dynamoDbClient.query(QueryRequest.builder()
        .tableName(TUTOR_STUDENTS_TABLE)
        .keyConditionExpression("tutor_email = :tutorEmail")
        .expressionAttributeValues(Map.of(
            ":tutorEmail", AttributeValue.builder().s(tutorEmail).build()
        ))
        .build());
    
    List<Map<String, Object>> students = new ArrayList<>();
    for (Map<String, AttributeValue> item : queryResponse.items()) {
        Map<String, Object> student = new HashMap<>();
        student.put("studentEmail", item.get("student_email").s());
        student.put("status", item.get("status").s());
        student.put("room", item.get("room").s());
        student.put("updated_at", Long.parseLong(item.get("updated_at").n())); // âœ…
        student.put("studentName", getStudentName(item.get("student_email").s(), context));
        students.add(student);
    }
    
    return createResponse(200, gson.toJson(Map.of("success", true, "data", Map.of("students", students))));
}
```

---

## í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„

### 1. useStudentStatus Hook (í•™ìƒìš©)

#### ğŸ“ ìœ„ì¹˜
`Project-Frontend/src/api/useStudentStatus.js`

#### ì‚¬ìš©ë²•
```javascript
// ChatPage.jsx, PracticePage.jsx, HomePage.jsx
import { useStudentStatus } from '../../api/useStudentStatus';

function ChatPage() {
  const user = useSelector(state => state.auth.user);
  const location = useLocation();
  
  useStudentStatus(user, location); // âœ… ìë™ìœ¼ë¡œ ìƒíƒœ ì „ì†¡
  
  // ... ë‚˜ë¨¸ì§€ ì½”ë“œ
}
```

#### ë™ì‘ ë°©ì‹
```javascript
export const useStudentStatus = (user, page) => {
  const currentPage = page?.pathname || page;
  const userEmail = user?.email;
  const tutorEmail = user?.tutorEmail;

  const sendStatus = useCallback(async () => {
    console.log(`ğŸ”„ ìƒíƒœ ì „ì†¡ | í•™ìƒ: ${userEmail} | í˜ì´ì§€: ${currentPage}`);
    return sendStudentStatus(userEmail, tutorEmail, currentPage);
  }, [userEmail, tutorEmail, currentPage]);

  // í˜ì´ì§€ ì ‘ì†/ë³€ê²½ ì‹œ ìë™ ì „ì†¡
  useEffect(() => {
    console.log(`âœ… useEffect íŠ¸ë¦¬ê±° | ${userEmail} | ${currentPage}`);
    sendStatus();
  }, [sendStatus, userEmail, currentPage]);

  // ë¸Œë¼ìš°ì € ì¢…ë£Œ ê°ì§€
  useEffect(() => {
    const handleBeforeUnload = () => {
      if (userEmail) {
        sendStudentStatusSync(userEmail, tutorEmail);
      }
    };
    window.addEventListener('beforeunload', handleBeforeUnload);
    return () => window.removeEventListener('beforeunload', handleBeforeUnload);
  }, [userEmail, tutorEmail]);

  return { sendStatus };
};
```

#### íŠ¸ë¦¬ê±° ì‹œì 
| ì´ë²¤íŠ¸ | ìƒíƒœ | ì„¤ëª… |
|--------|------|------|
| ë¡œê·¸ì¸ â†’ HomePage | ğŸŸ¡ ì˜¨ë¼ì¸ | room="no room" |
| HomePage â†’ ChatPage | ğŸŸ¢ AIëŒ€í™”ì¤‘ | room="ai" |
| ChatPage â†’ PracticePage | ğŸŸ¢ ë¬¸ì¥ì—°ìŠµì¤‘ | room="sentence" |
| ë¸Œë¼ìš°ì € ì¢…ë£Œ | ğŸ”´ ì˜¤í”„ë¼ì¸ | status="inactive" |
| ë¡œê·¸ì•„ì›ƒ | ğŸ”´ ì˜¤í”„ë¼ì¸ | status="inactive" |

---

### 2. timeUtils.js (ì‹œê°„ ìœ í‹¸ë¦¬í‹°)

#### ğŸ“ ìœ„ì¹˜
`Project-Frontend/src/utils/timeUtils.js`

#### ì£¼ìš” í•¨ìˆ˜

##### `isOnline(updatedAt, thresholdMinutes)`
```javascript
// ì˜¨ë¼ì¸ ì—¬ë¶€ íŒë‹¨ (ê¸°ë³¸ 5ë¶„)
const online = isOnline(student.updated_at, 5);
// true â†’ 5ë¶„ ì´ë‚´ í™œë™
// false â†’ 5ë¶„ ì´ìƒ ë¹„í™œì„±
```

##### `getTimeAgo(updatedAt)`
```javascript
// "3ë¶„ ì „", "2ì‹œê°„ ì „" í˜•ì‹
const timeAgo = getTimeAgo(student.updated_at);
// "ë°©ê¸ˆ ì „" | "3ë¶„ ì „" | "2ì‹œê°„ ì „" | "3ì¼ ì „"
```

##### `getStudentStatus(student)`
```javascript
// ì‹¤ì‹œê°„ ìƒíƒœ íŒë‹¨
const status = getStudentStatus(student);
// { statusText: "AIëŒ€í™”ì¤‘", emoji: "ğŸŸ¢", color: "green" }
```

#### ìƒíƒœ íŒë‹¨ ë¡œì§
```javascript
export const getStudentStatus = (student) => {
  const minutesAgo = (Date.now() - student.updated_at) / (1000 * 60);
  
  if (minutesAgo <= 5) {
    // 5ë¶„ ì´ë‚´ â†’ ì‹¤ì‹œê°„
    if (student.status === "inactive") return { statusText: "ë¡œê·¸ì•„ì›ƒ", emoji: "ğŸ”´", color: "red" };
    if (student.room === "ai") return { statusText: "AIëŒ€í™”ì¤‘", emoji: "ğŸŸ¢", color: "green" };
    if (student.room === "sentence") return { statusText: "ë¬¸ì¥ì—°ìŠµì¤‘", emoji: "ğŸŸ¢", color: "green" };
    return { statusText: "ì˜¨ë¼ì¸", emoji: "ğŸŸ¡", color: "yellow" };
  }
  
  if (minutesAgo <= 30) {
    // 5~30ë¶„ â†’ ìë¦¬ë¹„ì›€
    return { statusText: "ìë¦¬ë¹„ì›€", emoji: "ğŸŸ¡", color: "yellow" };
  }
  
  // 30ë¶„ ì´ìƒ â†’ ì˜¤í”„ë¼ì¸
  return { statusText: "ì˜¤í”„ë¼ì¸", emoji: "âšª", color: "gray" };
};
```

##### `formatTimestamp(timestamp)`
```javascript
// íƒ€ì„ìŠ¤íƒ¬í”„ â†’ ë‚ ì§œ ë¬¸ìì—´
const formatted = formatTimestamp(student.updated_at);
// "2026-01-27 14:25:45"
```

---

### 3. useTutorStudents Hook (íŠœí„°ìš©)

#### ğŸ“ ìœ„ì¹˜
`Project-Frontend/src/api/useTutorStudents.js`

#### ì‚¬ìš©ë²•
```javascript
import { useTutorStudents } from '../api/useTutorStudents';

function TutorDashboard() {
  const { students, loading, error, refetch } = useTutorStudents();
  
  if (loading) return <div>ë¡œë”© ì¤‘...</div>;
  if (error) return <div>ì—ëŸ¬: {error}</div>;
  
  return (
    <div>
      <button onClick={refetch}>ìƒˆë¡œê³ ì¹¨</button>
      {students.map(student => (
        <StudentStatusCard key={student.studentEmail} student={student} />
      ))}
    </div>
  );
}
```

---

### 4. StudentStatusCard ì»´í¬ë„ŒíŠ¸

#### ğŸ“ ìœ„ì¹˜
`Project-Frontend/src/components/StudentStatusCard.jsx`

#### í‘œì‹œ ë‚´ìš©
```jsx
import { getStudentStatus, getTimeAgo, formatTimestamp } from '../utils/timeUtils';

const StudentStatusCard = ({ student }) => {
  const statusInfo = getStudentStatus(student);
  const lastSeen = getTimeAgo(student.updated_at);

  return (
    <div className="border rounded-lg p-4">
      {/* ìƒíƒœ í‘œì‹œ */}
      <div className="flex items-center gap-2">
        <span>{statusInfo.emoji}</span>
        <span className={`text-${statusInfo.color}-600`}>
          {statusInfo.statusText}
        </span>
        <span className="text-xs text-gray-500">{lastSeen}</span>
      </div>

      {/* í•™ìƒ ì •ë³´ */}
      <h3>{student.studentName}</h3>
      <p>{student.studentEmail}</p>

      {/* í˜„ì¬ í™œë™ */}
      {statusInfo.emoji === "ğŸŸ¢" && student.room !== "no room" && (
        <div>
          {student.room === "ai" ? "ğŸ’¬ AIëŒ€í™” ì¤‘" : "ğŸ“ ë¬¸ì¥ì—°ìŠµ ì¤‘"}
        </div>
      )}

      {/* ë§ˆì§€ë§‰ í™œë™ ì‹œê°„ */}
      <div className="text-xs">
        ë§ˆì§€ë§‰ í™œë™: {formatTimestamp(student.updated_at)}
      </div>
    </div>
  );
};
```

---

## ìƒíƒœ íŒë‹¨ ë¡œì§

### ì‹¤ì‹œê°„ì„± ê¸°ì¤€

| ê²½ê³¼ ì‹œê°„ | ìƒíƒœ | ìƒ‰ìƒ | ì„¤ëª… |
|----------|------|------|------|
| 0~5ë¶„ | ì‹¤ì‹œê°„ í™œë™ | ğŸŸ¢/ğŸŸ¡ | status + room ê¸°ì¤€ íŒë‹¨ |
| 5~30ë¶„ | ìë¦¬ë¹„ì›€ | ğŸŸ¡ | ìµœê·¼ í™œë™ ìˆìŒ |
| 30ë¶„ ì´ìƒ | ì˜¤í”„ë¼ì¸ | âšª | ì¥ì‹œê°„ ë¹„í™œì„± |

### í˜ì´ì§€ë³„ room ë§¤í•‘

| í˜ì´ì§€ | pathname | room ê°’ | í‘œì‹œ ìƒíƒœ |
|--------|---------|---------|----------|
| HomePage | `/` | `"no room"` | ğŸŸ¡ ì˜¨ë¼ì¸ |
| ChatPage | `/chat` | `"ai"` | ğŸŸ¢ AIëŒ€í™”ì¤‘ |
| PracticePage | `/practice` | `"sentence"` | ğŸŸ¢ ë¬¸ì¥ì—°ìŠµì¤‘ |
| Logout | `/logout` | `"no room"` | ğŸ”´ ì˜¤í”„ë¼ì¸ (status="inactive") |

---

## ì‚¬ìš© ê°€ì´ë“œ

### í•™ìƒ ì¸¡ êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] ê° í˜ì´ì§€ì— `useStudentStatus(user, location)` ì¶”ê°€
  - [x] HomePage.jsx
  - [x] ChatPage.jsx
  - [x] PracticePage.jsx
- [x] ë¡œê·¸ì•„ì›ƒ ì‹œ ì˜¤í”„ë¼ì¸ ìƒíƒœ ì „ì†¡ (`auth.js`)
- [x] ë¸Œë¼ìš°ì € ì¢…ë£Œ ê°ì§€ (`beforeunload` ì´ë²¤íŠ¸)

### íŠœí„° ì¸¡ êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] `timeUtils.js` ìƒì„± ë° í•¨ìˆ˜ êµ¬í˜„
- [x] `useTutorStudents.js` Hook ìƒì„±
- [x] `StudentStatusCard.jsx` ì»´í¬ë„ŒíŠ¸ ìƒì„±
- [ ] TutorDashboard í˜ì´ì§€ì— ì ìš©
- [ ] ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ (Polling or WebSocket)

### ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

#### ë°±ì—”ë“œ
```bash
# ë¹Œë“œ
cd Project-Backend/StudentStatusFunction
./gradlew build

# SAM ë°°í¬
cd ../..
sam build
sam deploy
```

#### í”„ë¡ íŠ¸ì—”ë“œ
```bash
cd Project-Frontend
npm run build
# ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
```

---

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ 1: ì½˜ì†” ë¡œê·¸ê°€ ë¬´í•œ ë°˜ë³µ

**ì¦ìƒ:**
```
ğŸ”„ useStudentStatus í›… ì‹¤í–‰ | í•™ìƒ: xxx | í˜ì´ì§€: /chat
ğŸ”„ useStudentStatus í›… ì‹¤í–‰ | í•™ìƒ: xxx | í˜ì´ì§€: /chat
ğŸ”„ useStudentStatus í›… ì‹¤í–‰ | í•™ìƒ: xxx | í˜ì´ì§€: /chat
...
```

**ì›ì¸:**
- `location` ê°ì²´ ì „ì²´ë¥¼ ì˜ì¡´ì„±ìœ¼ë¡œ ì‚¬ìš©
- ì»´í¬ë„ŒíŠ¸ ë¦¬ë Œë”ë§ë§ˆë‹¤ ìƒˆë¡œìš´ `location` ì°¸ì¡° ìƒì„±

**í•´ê²°:**
```javascript
// âŒ Before
const sendStatus = useCallback(async () => {
    return sendStudentStatus(user?.email, user?.tutorEmail, page?.pathname || page);
}, [user?.email, user?.tutorEmail, page]); // page ê°ì²´ ì „ì²´

// âœ… After
const currentPage = page?.pathname || page;
const userEmail = user?.email;
const tutorEmail = user?.tutorEmail;

const sendStatus = useCallback(async () => {
    return sendStudentStatus(userEmail, tutorEmail, currentPage);
}, [userEmail, tutorEmail, currentPage]); // ì›ì‹œê°’ë§Œ
```

---

### ë¬¸ì œ 2: ë¸Œë¼ìš°ì €ë¥¼ ê»ë‹¤ ì¼œë„ ì˜¨ë¼ì¸ ìƒíƒœ

**ì¦ìƒ:**
- ë¸Œë¼ìš°ì € ì¢…ë£Œ â†’ ë‹¤ì‹œ ì ‘ì† â†’ ë°”ë¡œ ì˜¨ë¼ì¸ í‘œì‹œ

**ì›ì¸:**
- ì´ê²ƒì€ **ì •ìƒ ë™ì‘**ì…ë‹ˆë‹¤
- `beforeunload`ë¡œ ì˜¤í”„ë¼ì¸ ì „ì†¡ â†’ ë‹¤ì‹œ ì ‘ì† ì‹œ ìë™ ë¡œê·¸ì¸ â†’ ì˜¨ë¼ì¸ ì „ì†¡

**í•´ê²°:**
```javascript
// íŠœí„° ëŒ€ì‹œë³´ë“œì—ì„œ updated_at ê¸°ë°˜ìœ¼ë¡œ íŒë‹¨
const status = getStudentStatus(student);
// 30ë¶„ ì´ìƒ ë¹„í™œì„±ì´ë©´ ìë™ìœ¼ë¡œ ì˜¤í”„ë¼ì¸ í‘œì‹œ
```

---

### ë¬¸ì œ 3: updated_atì´ null

**ì¦ìƒ:**
```javascript
student.updated_at = null
```

**ì›ì¸:**
- ë°±ì—”ë“œì—ì„œ `updated_at`ì„ ìˆ«ìë¡œ ë°˜í™˜í•˜ì§€ ì•ŠìŒ

**í•´ê²°:**
```java
// âœ… TutorFeedbackHandler.java
student.put("updated_at", Long.parseLong(item.get("updated_at").n()));

// âŒ ì˜ëª»ëœ ì˜ˆ
student.put("updated_at", item.get("updated_at").n()); // String ë°˜í™˜
```

---

### ë¬¸ì œ 4: CORS ì—ëŸ¬

**ì¦ìƒ:**
```
Access to XMLHttpRequest at 'https://xxx/api/student-status' blocked by CORS
```

**í•´ê²°:**
```java
// StudentStatusController.java
private Map<String, String> createCorsHeaders() {
    Map<String, String> headers = new HashMap<>();
    headers.put("Content-Type", "application/json");
    headers.put("Access-Control-Allow-Origin", "*");
    headers.put("Access-Control-Allow-Methods", "POST, OPTIONS");
    headers.put("Access-Control-Allow-Headers", "Content-Type");
    return headers;
}
```

---

## í–¥í›„ ê°œì„  ì‚¬í•­

### 1. ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ (WebSocket)
í˜„ì¬: í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ í•„ìš”  
ê°œì„ : WebSocketìœ¼ë¡œ ì‹¤ì‹œê°„ Push

```javascript
// ì˜ˆì‹œ
const ws = new WebSocket('wss://api.example.com/tutor/students/live');
ws.onmessage = (event) => {
  const update = JSON.parse(event.data);
  // í•™ìƒ ìƒíƒœ ì—…ë°ì´íŠ¸
};
```

### 2. Polling ë°©ì‹
```javascript
useEffect(() => {
  const interval = setInterval(() => {
    refetch(); // 30ì´ˆë§ˆë‹¤ ê°±ì‹ 
  }, 30000);
  return () => clearInterval(interval);
}, [refetch]);
```

### 3. í•™ìƒ í•„í„°ë§
```javascript
const [filter, setFilter] = useState('all'); // 'all' | 'online' | 'offline'
const filteredStudents = students.filter(s => {
  if (filter === 'online') return isOnline(s.updated_at, 5);
  if (filter === 'offline') return !isOnline(s.updated_at, 5);
  return true;
});
```

### 4. ìƒíƒœ íˆìŠ¤í† ë¦¬
```javascript
// DynamoDBì— í•™ìƒ í™œë™ ë¡œê·¸ ì €ì¥
{
  student_email: "student@example.com",
  timestamp: 1738012345678,
  action: "entered_chat",
  room: "ai"
}
```

---

## ì°¸ê³  ìë£Œ

### ê´€ë ¨ ë¬¸ì„œ
- [WebSocket_SQS_DynamoDB_Implementation.md](./WebSocket_SQS_DynamoDB_Implementation.md)
- [í•™ìƒ_ì•Œë¦¼_ì‹œìŠ¤í…œ_í†µí•©_êµ¬í˜„_ê³„íš.md](../Project-Frontend/docs/í•™ìƒ_ì•Œë¦¼_ì‹œìŠ¤í…œ_í†µí•©_êµ¬í˜„_ê³„íš.md)

### API ì—”ë“œí¬ì¸íŠ¸ ì •ë¦¬
| ì—”ë“œí¬ì¸íŠ¸ | ë©”ì„œë“œ | ì„¤ëª… | ì‚¬ìš©ì |
|-----------|--------|------|--------|
| `/api/student-status` | POST | í•™ìƒ ìƒíƒœ ì €ì¥ | í•™ìƒ |
| `/api/tutor/students` | GET | ë‹´ë‹¹ í•™ìƒ ëª©ë¡ ì¡°íšŒ | íŠœí„° |

### ì£¼ìš” íŒŒì¼ ìœ„ì¹˜
```
Project-Backend/
â”œâ”€â”€ StudentStatusFunction/
â”‚   â””â”€â”€ src/main/java/com/speaktracker/studentstatus/
â””â”€â”€ TutorFunction/
    â””â”€â”€ src/main/java/com/speaktracker/tutor/

Project-Frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ useStudentStatus.js
â”‚   â”‚   â””â”€â”€ useTutorStudents.js
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ timeUtils.js
â”‚   â””â”€â”€ components/
â”‚       â””â”€â”€ StudentStatusCard.jsx
```

---

## ë§ˆë¬´ë¦¬

ì´ ë¡œë“œë§µì„ ë”°ë¼ êµ¬í˜„í•˜ë©´ íŠœí„°ê°€ í•™ìƒì˜ ì‹¤ì‹œê°„ ìƒíƒœë¥¼ ì •í™•í•˜ê²Œ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**í•µì‹¬ í¬ì¸íŠ¸:**
1. âœ… **í˜ì´ì§€ë³„ ìë™ ìƒíƒœ ì „ì†¡** - useStudentStatus Hook
2. âœ… **íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜ íŒë‹¨** - updated_atìœ¼ë¡œ ì‹¤ì‹œê°„ì„± í™•ì¸
3. âœ… **ë¸Œë¼ìš°ì € ì¢…ë£Œ ê°ì§€** - beforeunload ì´ë²¤íŠ¸
4. âœ… **ë¡œê·¸ì¸ ìœ ì§€** - localStorage + RefreshToken

**ë‹¤ìŒ ë‹¨ê³„:**
- TutorDashboard í˜ì´ì§€ì— StudentStatusCard ì ìš©
- ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ê¸°ëŠ¥ ì¶”ê°€ (Polling or WebSocket)
- í•™ìƒ í™œë™ íˆìŠ¤í† ë¦¬ ë¡œê¹…

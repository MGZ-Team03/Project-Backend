---
title: SpeakTracker - ë¡œê·¸ì¸ ì‹œí€€ìŠ¤
---
sequenceDiagram
    autonumber
    participant U as ğŸ‘¤ User
    participant FE as ğŸ–¥ï¸ React App
    participant API as ğŸ”Œ API Gateway
    participant Lambda as âš¡ Lambda
    participant Cognito as ğŸ” Cognito
    participant DB as ğŸ—„ï¸ DynamoDB
    participant WS as ğŸ”— WebSocket

    rect rgb(230, 255, 230)
        Note over U,WS: ë¡œê·¸ì¸ í”„ë¡œì„¸ìŠ¤
        U->>FE: ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ì…ë ¥
        FE->>API: POST /api/auth/login
        API->>Lambda: Invoke AuthHandler
        Lambda->>Cognito: initiateAuth(email, password)
        
        alt ì¸ì¦ ì„±ê³µ
            Cognito-->>Lambda: JWT Tokens<br/>(accessToken, refreshToken, idToken)
            Lambda->>DB: Query Users {role, email}
            DB-->>Lambda: User profile (name, role)
            Lambda-->>API: 200 OK + tokens + user
            API-->>FE: {accessToken, refreshToken, user}
            FE->>FE: localStorageì— í† í° ì €ì¥
            FE->>WS: WebSocket ì—°ê²°
            WS-->>FE: Connected
            
            alt role == "student"
                FE-->>U: /student/home ë¦¬ë””ë ‰ì…˜
            else role == "tutor"
                FE-->>U: /tutor/dashboard ë¦¬ë””ë ‰ì…˜
            end
        else ì¸ì¦ ì‹¤íŒ¨
            Cognito-->>Lambda: NotAuthorizedException
            Lambda-->>API: 401 Unauthorized
            API-->>FE: "ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤"
            FE-->>U: ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
        end
    end

    rect rgb(255, 255, 230)
        Note over U,WS: í† í° ìë™ ê°±ì‹  (1ì‹œê°„ í›„)
        FE->>API: Any API Request (401 ì‘ë‹µ)
        API-->>FE: 401 Unauthorized (í† í° ë§Œë£Œ)
        FE->>API: POST /api/auth/refresh
        API->>Lambda: Invoke AuthHandler
        Lambda->>Cognito: refreshToken
        Cognito-->>Lambda: New accessToken
        Lambda-->>API: 200 OK
        API-->>FE: {accessToken, expiresIn: 3600}
        FE->>FE: ìƒˆ í† í°ìœ¼ë¡œ ì›ë˜ ìš”ì²­ ì¬ì‹œë„
    end
